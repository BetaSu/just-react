<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React æŠ€æœ¯æ­ç§˜</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="Reactæºç è§£æ">
    <link rel="preload" href="/just-react/assets/css/0.styles.4300949d.css" as="style"><link rel="preload" href="/just-react/assets/js/app.3ca5235f.js" as="script"><link rel="preload" href="/just-react/assets/js/2.ceab786f.js" as="script"><link rel="preload" href="/just-react/assets/js/8.fb63fdcd.js" as="script"><link rel="prefetch" href="/just-react/assets/js/10.85a9a20d.js"><link rel="prefetch" href="/just-react/assets/js/11.932b412d.js"><link rel="prefetch" href="/just-react/assets/js/12.f242cd2d.js"><link rel="prefetch" href="/just-react/assets/js/13.03453b62.js"><link rel="prefetch" href="/just-react/assets/js/14.1eca8eb4.js"><link rel="prefetch" href="/just-react/assets/js/15.dc2f6e5e.js"><link rel="prefetch" href="/just-react/assets/js/16.a18f2ae6.js"><link rel="prefetch" href="/just-react/assets/js/17.faab250d.js"><link rel="prefetch" href="/just-react/assets/js/18.5fbf02a3.js"><link rel="prefetch" href="/just-react/assets/js/19.f49e92b5.js"><link rel="prefetch" href="/just-react/assets/js/20.d286fee0.js"><link rel="prefetch" href="/just-react/assets/js/21.048ef0cd.js"><link rel="prefetch" href="/just-react/assets/js/22.6266ec24.js"><link rel="prefetch" href="/just-react/assets/js/23.499ba392.js"><link rel="prefetch" href="/just-react/assets/js/24.bf405dce.js"><link rel="prefetch" href="/just-react/assets/js/25.ce9b9c12.js"><link rel="prefetch" href="/just-react/assets/js/26.b9eeed1a.js"><link rel="prefetch" href="/just-react/assets/js/27.bb7812ac.js"><link rel="prefetch" href="/just-react/assets/js/28.7cf508b5.js"><link rel="prefetch" href="/just-react/assets/js/29.874fb249.js"><link rel="prefetch" href="/just-react/assets/js/3.540ccf28.js"><link rel="prefetch" href="/just-react/assets/js/30.16070aa2.js"><link rel="prefetch" href="/just-react/assets/js/31.f0fa4d21.js"><link rel="prefetch" href="/just-react/assets/js/32.64085e73.js"><link rel="prefetch" href="/just-react/assets/js/33.3aedd51d.js"><link rel="prefetch" href="/just-react/assets/js/34.701196c0.js"><link rel="prefetch" href="/just-react/assets/js/35.c834d299.js"><link rel="prefetch" href="/just-react/assets/js/4.10c8f825.js"><link rel="prefetch" href="/just-react/assets/js/5.e9b9f33b.js"><link rel="prefetch" href="/just-react/assets/js/6.bb2347f8.js"><link rel="prefetch" href="/just-react/assets/js/7.35de3e13.js"><link rel="prefetch" href="/just-react/assets/js/9.833803a9.js">
    <link rel="stylesheet" href="/just-react/assets/css/0.styles.4300949d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/just-react/" class="home-link router-link-active"><!----> <span class="site-name">React æŠ€æœ¯æ­ç§˜</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/just-react/me.html" class="nav-link">
  ğŸ™‹â€â™‚ï¸ ä¸€èµ·å­¦ä¹ 
</a></div> <a href="https://github.com/BetaSu/just-react" target="_blank" rel="noopener noreferrer" class="repo-link">
    ç‚¹äº®â­ä¸è¿·è·¯
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/just-react/me.html" class="nav-link">
  ğŸ™‹â€â™‚ï¸ ä¸€èµ·å­¦ä¹ 
</a></div> <a href="https://github.com/BetaSu/just-react" target="_blank" rel="noopener noreferrer" class="repo-link">
    ç‚¹äº®â­ä¸è¿·è·¯
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/just-react/" aria-current="page" class="sidebar-link">å‰è¨€</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç¬¬ä¸€ç«  å‰ç½®çŸ¥è¯†</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç¬¬äºŒç«  renderé˜¶æ®µ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç¬¬ä¸‰ç«  commité˜¶æ®µ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç¬¬å››ç«  Diffç®—æ³•</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç¬¬äº”ç«  çŠ¶æ€æ›´æ–°</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ç¬¬å…­ç«  Hooks</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/just-react/hooks/prepare.html" class="sidebar-link">Hooksç†å¿µ</a></li><li><a href="/just-react/hooks/create.html" aria-current="page" class="active sidebar-link">æç®€Hookså®ç°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/just-react/hooks/create.html#å·¥ä½œåŸç†" class="sidebar-link">å·¥ä½œåŸç†</a></li><li class="sidebar-sub-header"><a href="/just-react/hooks/create.html#æ›´æ–°æ˜¯ä»€ä¹ˆ" class="sidebar-link">æ›´æ–°æ˜¯ä»€ä¹ˆ</a></li><li class="sidebar-sub-header"><a href="/just-react/hooks/create.html#updateæ•°æ®ç»“æ„" class="sidebar-link">updateæ•°æ®ç»“æ„</a></li><li class="sidebar-sub-header"><a href="/just-react/hooks/create.html#çŠ¶æ€å¦‚ä½•ä¿å­˜" class="sidebar-link">çŠ¶æ€å¦‚ä½•ä¿å­˜</a></li><li class="sidebar-sub-header"><a href="/just-react/hooks/create.html#hookæ•°æ®ç»“æ„" class="sidebar-link">Hookæ•°æ®ç»“æ„</a></li><li class="sidebar-sub-header"><a href="/just-react/hooks/create.html#æ¨¡æ‹Ÿreactè°ƒåº¦æ›´æ–°æµç¨‹" class="sidebar-link">æ¨¡æ‹ŸReactè°ƒåº¦æ›´æ–°æµç¨‹</a></li><li class="sidebar-sub-header"><a href="/just-react/hooks/create.html#è®¡ç®—state" class="sidebar-link">è®¡ç®—state</a></li><li class="sidebar-sub-header"><a href="/just-react/hooks/create.html#å¯¹è§¦å‘äº‹ä»¶è¿›è¡ŒæŠ½è±¡" class="sidebar-link">å¯¹è§¦å‘äº‹ä»¶è¿›è¡ŒæŠ½è±¡</a></li><li class="sidebar-sub-header"><a href="/just-react/hooks/create.html#åœ¨çº¿demo" class="sidebar-link">åœ¨çº¿Demo</a></li><li class="sidebar-sub-header"><a href="/just-react/hooks/create.html#ä¸reactçš„åŒºåˆ«" class="sidebar-link">ä¸Reactçš„åŒºåˆ«</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>ä¸ºäº†æ›´å¥½ç†è§£<code>Hooks</code>åŸç†ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬éµå¾ª<code>React</code>çš„è¿è¡Œæµç¨‹ï¼Œå®ç°ä¸€ä¸ªä¸åˆ°100è¡Œä»£ç çš„æç®€<code>useState Hook</code>ã€‚</p> <p>è¿™æ˜¯<a href="/just-react/hooks/create.html#åœ¨çº¿demo">åœ¨çº¿Demo</a>ï¼Œå»ºè®®å¯¹ç…§ç€ä»£ç æ¥çœ‹æœ¬èŠ‚å†…å®¹ã€‚</p> <h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="header-anchor">#</a> å·¥ä½œåŸç†</h2> <p>å¯¹äº<code>useState Hook</code>ï¼Œè€ƒè™‘å¦‚ä¸‹ä¾‹å­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> updateNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>p onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¯ä»¥å°†å·¥ä½œåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p> <ol><li>é€šè¿‡ä¸€äº›é€”å¾„äº§ç”Ÿ<code>æ›´æ–°</code>ï¼Œ<code>æ›´æ–°</code>ä¼šé€ æˆç»„ä»¶<code>render</code>ã€‚</li> <li>ç»„ä»¶<code>render</code>æ—¶<code>useState</code>è¿”å›çš„<code>num</code>ä¸ºæ›´æ–°åçš„ç»“æœã€‚</li></ol> <p>å…¶ä¸­<code>æ­¥éª¤1</code>çš„<code>æ›´æ–°</code>å¯ä»¥åˆ†ä¸º<code>mount</code>å’Œ<code>update</code>ï¼š</p> <ol><li>è°ƒç”¨<code>ReactDOM.render</code>ä¼šäº§ç”Ÿ<code>mount</code>çš„<code>æ›´æ–°</code>ï¼Œ<code>æ›´æ–°</code>å†…å®¹ä¸º<code>useState</code>çš„<code>initialValue</code>ï¼ˆå³<code>0</code>ï¼‰ã€‚</li> <li>ç‚¹å‡»<code>p</code>æ ‡ç­¾è§¦å‘<code>updateNum</code>ä¼šäº§ç”Ÿä¸€æ¬¡<code>update</code>çš„<code>æ›´æ–°</code>ï¼Œ<code>æ›´æ–°</code>å†…å®¹ä¸º<code>num =&gt; num + 1</code>ã€‚</li></ol> <p>æ¥ä¸‹æ¥è®²è§£è¿™ä¸¤ä¸ªæ­¥éª¤å¦‚ä½•å®ç°ã€‚</p> <h2 id="æ›´æ–°æ˜¯ä»€ä¹ˆ"><a href="#æ›´æ–°æ˜¯ä»€ä¹ˆ" class="header-anchor">#</a> æ›´æ–°æ˜¯ä»€ä¹ˆ</h2> <blockquote><ol><li>é€šè¿‡ä¸€äº›é€”å¾„äº§ç”Ÿ<code>æ›´æ–°</code>ï¼Œ<code>æ›´æ–°</code>ä¼šé€ æˆç»„ä»¶<code>render</code>ã€‚</li></ol></blockquote> <p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®<code>æ›´æ–°</code>æ˜¯ä»€ä¹ˆã€‚</p> <p>åœ¨æˆ‘ä»¬çš„æç®€ä¾‹å­ä¸­ï¼Œ<code>æ›´æ–°</code>å°±æ˜¯å¦‚ä¸‹æ•°æ®ç»“æ„ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> update <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ›´æ–°æ‰§è¡Œçš„å‡½æ•°</span>
  action<span class="token punctuation">,</span>
  <span class="token comment">// ä¸åŒä¸€ä¸ªHookçš„å…¶ä»–æ›´æ–°å½¢æˆé“¾è¡¨</span>
  next<span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¯¹äº<code>App</code>æ¥è¯´ï¼Œç‚¹å‡»<code>p</code>æ ‡ç­¾äº§ç”Ÿçš„<code>update</code>çš„<code>action</code>ä¸º<code>num =&gt; num + 1</code>ã€‚</p> <p>å¦‚æœæˆ‘ä»¬æ”¹å†™ä¸‹<code>App</code>çš„<code>onClick</code>ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ä¹‹å‰</span>
<span class="token keyword">return</span> <span class="token operator">&lt;</span>p onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// ä¹‹å</span>
<span class="token keyword">return</span> <span class="token operator">&lt;</span>p onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><p>é‚£ä¹ˆç‚¹å‡»<code>p</code>æ ‡ç­¾ä¼šäº§ç”Ÿä¸‰ä¸ª<code>update</code>ã€‚</p> <h2 id="updateæ•°æ®ç»“æ„"><a href="#updateæ•°æ®ç»“æ„" class="header-anchor">#</a> updateæ•°æ®ç»“æ„</h2> <p>è¿™äº›<code>update</code>æ˜¯å¦‚ä½•ç»„åˆåœ¨ä¸€èµ·å‘¢ï¼Ÿ</p> <p>ç­”æ¡ˆæ˜¯ï¼šä»–ä»¬ä¼šå½¢æˆ<code>ç¯çŠ¶å•å‘é“¾è¡¨</code>ã€‚</p> <p>è°ƒç”¨<code>updateNum</code>å®é™…è°ƒç”¨çš„æ˜¯<code>dispatchAction.bind(null, hook.queue)</code>ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹è¿™ä¸ªå‡½æ•°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">dispatchAction</span><span class="token punctuation">(</span><span class="token parameter">queue<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆ›å»ºupdate</span>
  <span class="token keyword">const</span> update <span class="token operator">=</span> <span class="token punctuation">{</span>
    action<span class="token punctuation">,</span>
    next<span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ç¯çŠ¶å•å‘é“¾è¡¨æ“ä½œ</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>pending <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    update<span class="token punctuation">.</span>next <span class="token operator">=</span> update<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    update<span class="token punctuation">.</span>next <span class="token operator">=</span> queue<span class="token punctuation">.</span>pending<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    queue<span class="token punctuation">.</span>pending<span class="token punctuation">.</span>next <span class="token operator">=</span> update<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> update<span class="token punctuation">;</span>

  <span class="token comment">// æ¨¡æ‹ŸReactå¼€å§‹è°ƒåº¦æ›´æ–°</span>
  <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç¯çŠ¶é“¾è¡¨æ“ä½œä¸å¤ªå®¹æ˜“ç†è§£ï¼Œè¿™é‡Œæˆ‘ä»¬è¯¦ç»†è®²è§£ä¸‹ã€‚</p> <p>å½“äº§ç”Ÿç¬¬ä¸€ä¸ª<code>update</code>ï¼ˆæˆ‘ä»¬å«ä»–<code>u0</code>ï¼‰ï¼Œæ­¤æ—¶<code>queue.pending === null</code>ã€‚</p> <p><code>update.next = update;</code>å³<code>u0.next = u0</code>ï¼Œä»–ä¼šå’Œè‡ªå·±é¦–å°¾ç›¸è¿å½¢æˆ<code>å•å‘ç¯çŠ¶é“¾è¡¨</code>ã€‚</p> <p>ç„¶å<code>queue.pending = update;</code>å³<code>queue.pending = u0</code></p> <div class="language-js extra-class"><pre class="language-js"><code>queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> u0 <span class="token operator">--</span><span class="token operator">-</span><span class="token operator">&gt;</span> u0
                <span class="token operator">^</span>       <span class="token operator">|</span>
                <span class="token operator">|</span>       <span class="token operator">|</span>
                <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
</code></pre></div><p>å½“äº§ç”Ÿç¬¬äºŒä¸ª<code>update</code>ï¼ˆæˆ‘ä»¬å«ä»–<code>u1</code>ï¼‰ï¼Œ<code>update.next = queue.pending.next;</code>ï¼Œæ­¤æ—¶<code>queue.pending.next === u0</code>ï¼Œ
å³<code>u1.next = u0</code>ã€‚</p> <p><code>queue.pending.next = update;</code>ï¼Œå³<code>u0.next = u1</code>ã€‚</p> <p>ç„¶å<code>queue.pending = update;</code>å³<code>queue.pending = u1</code></p> <div class="language-js extra-class"><pre class="language-js"><code>queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> u1 <span class="token operator">--</span><span class="token operator">-</span><span class="token operator">&gt;</span> u0   
                <span class="token operator">^</span>       <span class="token operator">|</span>
                <span class="token operator">|</span>       <span class="token operator">|</span>
                <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
</code></pre></div><p>ä½ å¯ä»¥ç…§ç€è¿™ä¸ªä¾‹å­æ¨¡æ‹Ÿæ’å…¥å¤šä¸ª<code>update</code>çš„æƒ…å†µï¼Œä¼šå‘ç°<code>queue.pending</code>å§‹ç»ˆæŒ‡å‘æœ€åä¸€ä¸ªæ’å…¥çš„<code>update</code>ã€‚</p> <p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå½“æˆ‘ä»¬è¦éå†<code>update</code>æ—¶ï¼Œ<code>queue.pending.next</code>æŒ‡å‘ç¬¬ä¸€ä¸ªæ’å…¥çš„<code>update</code>ã€‚</p> <h2 id="çŠ¶æ€å¦‚ä½•ä¿å­˜"><a href="#çŠ¶æ€å¦‚ä½•ä¿å­˜" class="header-anchor">#</a> çŠ¶æ€å¦‚ä½•ä¿å­˜</h2> <p>ç°åœ¨æˆ‘ä»¬çŸ¥é“ï¼Œ<code>æ›´æ–°</code>äº§ç”Ÿçš„<code>update</code>å¯¹è±¡ä¼šä¿å­˜åœ¨<code>queue</code>ä¸­ã€‚</p> <p>ä¸åŒäº<code>ClassComponent</code>çš„å®ä¾‹å¯ä»¥å­˜å‚¨æ•°æ®ï¼Œå¯¹äº<code>FunctionComponent</code>ï¼Œ<code>queue</code>å­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p> <p>ç­”æ¡ˆæ˜¯ï¼š<code>FunctionComponent</code>å¯¹åº”çš„<code>fiber</code>ä¸­ã€‚</p> <p>æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹ç²¾ç®€çš„<code>fiber</code>ç»“æ„ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Appç»„ä»¶å¯¹åº”çš„fiberå¯¹è±¡</span>
<span class="token keyword">const</span> fiber <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¿å­˜è¯¥FunctionComponentå¯¹åº”çš„Hooksé“¾è¡¨</span>
  memoizedState<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token comment">// æŒ‡å‘Appå‡½æ•°</span>
  stateNode<span class="token operator">:</span> App
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="hookæ•°æ®ç»“æ„"><a href="#hookæ•°æ®ç»“æ„" class="header-anchor">#</a> Hookæ•°æ®ç»“æ„</h2> <p>æ¥ä¸‹æ¥æˆ‘ä»¬å…³æ³¨<code>fiber.memoizedState</code>ä¸­ä¿å­˜çš„<code>Hook</code>çš„æ•°æ®ç»“æ„ã€‚</p> <p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>Hook</code>ä¸<code>update</code>ç±»ä¼¼ï¼Œéƒ½é€šè¿‡<code>é“¾è¡¨</code>è¿æ¥ã€‚ä¸è¿‡<code>Hook</code>æ˜¯<code>æ— ç¯</code>çš„<code>å•å‘é“¾è¡¨</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>hook <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¿å­˜updateçš„queueï¼Œå³ä¸Šæ–‡ä»‹ç»çš„queue</span>
  queue<span class="token operator">:</span> <span class="token punctuation">{</span>
    pending<span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ä¿å­˜hookå¯¹åº”çš„state</span>
  memoizedState<span class="token operator">:</span> initialState<span class="token punctuation">,</span>
  <span class="token comment">// ä¸ä¸‹ä¸€ä¸ªHookè¿æ¥å½¢æˆå•å‘æ— ç¯é“¾è¡¨</span>
  next<span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">æ³¨æ„</p> <p>æ³¨æ„åŒºåˆ†<code>update</code>ä¸<code>hook</code>çš„æ‰€å±å…³ç³»ï¼š</p> <p>æ¯ä¸ª<code>useState</code>å¯¹åº”ä¸€ä¸ª<code>hook</code>å¯¹è±¡ã€‚</p> <p>è°ƒç”¨<code>const [num, updateNum] = useState(0);</code>æ—¶<code>updateNum</code>ï¼ˆå³ä¸Šæ–‡ä»‹ç»çš„<code>dispatchAction</code>ï¼‰äº§ç”Ÿçš„<code>update</code>ä¿å­˜åœ¨<code>useState</code>å¯¹åº”çš„<code>hook.queue</code>ä¸­ã€‚</p></div> <h2 id="æ¨¡æ‹Ÿreactè°ƒåº¦æ›´æ–°æµç¨‹"><a href="#æ¨¡æ‹Ÿreactè°ƒåº¦æ›´æ–°æµç¨‹" class="header-anchor">#</a> æ¨¡æ‹ŸReactè°ƒåº¦æ›´æ–°æµç¨‹</h2> <p>åœ¨ä¸Šæ–‡<code>dispatchAction</code>æœ«å°¾æˆ‘ä»¬é€šè¿‡<code>schedule</code>æ–¹æ³•æ¨¡æ‹Ÿ<code>React</code>è°ƒåº¦æ›´æ–°æµç¨‹ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">dispatchAction</span><span class="token punctuation">(</span><span class="token parameter">queue<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...åˆ›å»ºupdate</span>
  
  <span class="token comment">// ...ç¯çŠ¶å•å‘é“¾è¡¨æ“ä½œ</span>

  <span class="token comment">// æ¨¡æ‹ŸReactå¼€å§‹è°ƒåº¦æ›´æ–°</span>
  <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç°åœ¨æˆ‘ä»¬æ¥å®ç°ä»–ã€‚</p> <p>æˆ‘ä»¬ç”¨<code>isMount</code>å˜é‡æŒ‡ä»£æ˜¯<code>mount</code>è¿˜æ˜¯<code>update</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// é¦–æ¬¡renderæ—¶æ˜¯mount</span>
isMount <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ›´æ–°å‰å°†workInProgressHooké‡ç½®ä¸ºfiberä¿å­˜çš„ç¬¬ä¸€ä¸ªHook</span>
  workInProgressHook <span class="token operator">=</span> fiber<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
  <span class="token comment">// è§¦å‘ç»„ä»¶render</span>
  fiber<span class="token punctuation">.</span><span class="token function">stateNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ç»„ä»¶é¦–æ¬¡renderä¸ºmountï¼Œä»¥åå†è§¦å‘çš„æ›´æ–°ä¸ºupdate</span>
  isMount <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>é€šè¿‡<code>workInProgressHook</code>å˜é‡æŒ‡å‘å½“å‰æ­£åœ¨å·¥ä½œçš„<code>hook</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>workInProgressHook <span class="token operator">=</span> fiber<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
</code></pre></div><p>åœ¨ç»„ä»¶<code>render</code>æ—¶ï¼Œæ¯å½“é‡åˆ°ä¸‹ä¸€ä¸ª<code>useState</code>ï¼Œæˆ‘ä»¬ç§»åŠ¨<code>workInProgressHook</code>çš„æŒ‡é’ˆã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
</code></pre></div><p>è¿™æ ·ï¼Œåªè¦æ¯æ¬¡ç»„ä»¶<code>render</code>æ—¶<code>useState</code>çš„è°ƒç”¨é¡ºåºåŠæ•°é‡ä¿æŒä¸€è‡´ï¼Œé‚£ä¹ˆå§‹ç»ˆå¯ä»¥é€šè¿‡<code>workInProgressHook</code>æ‰¾åˆ°å½“å‰<code>useState</code>å¯¹åº”çš„<code>hook</code>å¯¹è±¡ã€‚</p> <p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆç¬¬ä¸€æ­¥ã€‚</p> <blockquote><ol><li>é€šè¿‡ä¸€äº›é€”å¾„äº§ç”Ÿ<code>æ›´æ–°</code>ï¼Œ<code>æ›´æ–°</code>ä¼šé€ æˆç»„ä»¶<code>render</code>ã€‚</li></ol></blockquote> <p>æ¥ä¸‹æ¥å®ç°ç¬¬äºŒæ­¥ã€‚</p> <blockquote><ol start="2"><li>ç»„ä»¶<code>render</code>æ—¶<code>useState</code>è¿”å›çš„<code>num</code>ä¸ºæ›´æ–°åçš„ç»“æœã€‚</li></ol></blockquote> <h2 id="è®¡ç®—state"><a href="#è®¡ç®—state" class="header-anchor">#</a> è®¡ç®—state</h2> <p>ç»„ä»¶<code>render</code>æ—¶ä¼šè°ƒç”¨<code>useState</code>ï¼Œä»–çš„å¤§ä½“é€»è¾‘å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å½“å‰useStateä½¿ç”¨çš„hookä¼šè¢«èµ‹å€¼è¯¥è¯¥å˜é‡</span>
  <span class="token keyword">let</span> hook<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>isMount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...mountæ—¶éœ€è¦ç”Ÿæˆhookå¯¹è±¡</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...updateæ—¶ä»workInProgressHookä¸­å–å‡ºè¯¥useStateå¯¹åº”çš„hook</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> baseState <span class="token operator">=</span> hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...æ ¹æ®queue.pendingä¸­ä¿å­˜çš„updateæ›´æ–°state</span>
  <span class="token punctuation">}</span>
  hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> baseState<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>baseState<span class="token punctuation">,</span> <span class="token function">dispatchAction</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬é¦–å…ˆå…³æ³¨å¦‚ä½•è·å–<code>hook</code>å¯¹è±¡ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>isMount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// mountæ—¶ä¸ºè¯¥useStateç”Ÿæˆhook</span>
  hook <span class="token operator">=</span> <span class="token punctuation">{</span>
    queue<span class="token operator">:</span> <span class="token punctuation">{</span>
      pending<span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    memoizedState<span class="token operator">:</span> initialState<span class="token punctuation">,</span>
    next<span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// å°†hookæ’å…¥fiber.memoizedStateé“¾è¡¨æœ«å°¾</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fiber<span class="token punctuation">.</span>memoizedState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fiber<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> hook<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    workInProgressHook<span class="token punctuation">.</span>next <span class="token operator">=</span> hook<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ç§»åŠ¨workInProgressHookæŒ‡é’ˆ</span>
  workInProgressHook <span class="token operator">=</span> hook<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// updateæ—¶æ‰¾åˆ°å¯¹åº”hook</span>
  hook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">;</span>
  <span class="token comment">// ç§»åŠ¨workInProgressHookæŒ‡é’ˆ</span>
  workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>å½“æ‰¾åˆ°è¯¥<code>useState</code>å¯¹åº”çš„<code>hook</code>åï¼Œå¦‚æœè¯¥<code>hook.queue.pending</code>ä¸ä¸ºç©ºï¼ˆå³å­˜åœ¨<code>update</code>ï¼‰ï¼Œåˆ™æ›´æ–°å…¶<code>state</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// updateæ‰§è¡Œå‰çš„åˆå§‹state</span>
<span class="token keyword">let</span> baseState <span class="token operator">=</span> hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è·å–updateç¯çŠ¶å•å‘é“¾è¡¨ä¸­ç¬¬ä¸€ä¸ªupdate</span>
  <span class="token keyword">let</span> firstUpdate <span class="token operator">=</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

  <span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‰§è¡Œupdate action</span>
    <span class="token keyword">const</span> action <span class="token operator">=</span> firstUpdate<span class="token punctuation">.</span>action<span class="token punctuation">;</span>
    baseState <span class="token operator">=</span> <span class="token function">action</span><span class="token punctuation">(</span>baseState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    firstUpdate <span class="token operator">=</span> firstUpdate<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

    <span class="token comment">// æœ€åä¸€ä¸ªupdateæ‰§è¡Œå®Œåè·³å‡ºå¾ªç¯</span>
  <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>firstUpdate <span class="token operator">!==</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">)</span>

  <span class="token comment">// æ¸…ç©ºqueue.pending</span>
  hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å°†update actionæ‰§è¡Œå®Œåçš„stateä½œä¸ºmemoizedState</span>
hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> baseState<span class="token punctuation">;</span>
</code></pre></div><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> hook<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>isMount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    hook <span class="token operator">=</span> <span class="token punctuation">{</span>
      queue<span class="token operator">:</span> <span class="token punctuation">{</span>
        pending<span class="token operator">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      memoizedState<span class="token operator">:</span> initialState<span class="token punctuation">,</span>
      next<span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fiber<span class="token punctuation">.</span>memoizedState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fiber<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> hook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      workInProgressHook<span class="token punctuation">.</span>next <span class="token operator">=</span> hook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    workInProgressHook <span class="token operator">=</span> hook<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    hook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">;</span>
    workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> baseState <span class="token operator">=</span> hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> firstUpdate <span class="token operator">=</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

    <span class="token keyword">do</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> action <span class="token operator">=</span> firstUpdate<span class="token punctuation">.</span>action<span class="token punctuation">;</span>
      baseState <span class="token operator">=</span> <span class="token function">action</span><span class="token punctuation">(</span>baseState<span class="token punctuation">)</span><span class="token punctuation">;</span>
      firstUpdate <span class="token operator">=</span> firstUpdate<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>firstUpdate <span class="token operator">!==</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending<span class="token punctuation">)</span>

    hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> baseState<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>baseState<span class="token punctuation">,</span> <span class="token function">dispatchAction</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="å¯¹è§¦å‘äº‹ä»¶è¿›è¡ŒæŠ½è±¡"><a href="#å¯¹è§¦å‘äº‹ä»¶è¿›è¡ŒæŠ½è±¡" class="header-anchor">#</a> å¯¹è§¦å‘äº‹ä»¶è¿›è¡ŒæŠ½è±¡</h2> <p>æœ€åï¼Œè®©æˆ‘ä»¬æŠ½è±¡ä¸€ä¸‹<code>React</code>çš„äº‹ä»¶è§¦å‘æ–¹å¼ã€‚</p> <p>é€šè¿‡è°ƒç”¨<code>App</code>è¿”å›çš„<code>click</code>æ–¹æ³•æ¨¡æ‹Ÿç»„ä»¶<code>click</code>çš„è¡Œä¸ºã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> updateNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>isMount <span class="token operator">?</span> <span class="token string">'mount'</span> <span class="token operator">:</span> <span class="token string">'update'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> num: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="åœ¨çº¿demo"><a href="#åœ¨çº¿demo" class="header-anchor">#</a> åœ¨çº¿Demo</h2> <p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªä¸åˆ°100è¡Œä»£ç çš„<code>Hooks</code>ã€‚é‡è¦çš„æ˜¯ï¼Œä»–ä¸<code>React</code>çš„è¿è¡Œé€»è¾‘ç›¸åŒã€‚</p> <details class="custom-block details"><summary>ç²¾ç®€Hooksçš„åœ¨çº¿Demo</summary> <p>è°ƒç”¨<code>window.click()</code>æ¨¡æ‹Ÿç»„ä»¶ç‚¹å‡»äº‹ä»¶ã€‚</p> <p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ª<code>useState</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> updateNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>num1<span class="token punctuation">,</span> updateNum1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>isMount <span class="token operator">?</span> <span class="token string">'mount'</span> <span class="token operator">:</span> <span class="token string">'update'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> num: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>isMount <span class="token operator">?</span> <span class="token string">'mount'</span> <span class="token operator">:</span> <span class="token string">'update'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> num1: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> num1<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">updateNum</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">updateNum1</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://code.h5jun.com/woniq/1/edit?js,console" target="_blank" rel="noopener noreferrer">Demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></details> <h2 id="ä¸reactçš„åŒºåˆ«"><a href="#ä¸reactçš„åŒºåˆ«" class="header-anchor">#</a> ä¸Reactçš„åŒºåˆ«</h2> <p>æˆ‘ä»¬ç”¨å°½å¯èƒ½å°‘çš„ä»£ç æ¨¡æ‹Ÿäº†<code>Hooks</code>çš„è¿è¡Œï¼Œä½†æ˜¯ç›¸æ¯”<code>React Hooks</code>ï¼Œä»–è¿˜æœ‰å¾ˆå¤šä¸è¶³ã€‚ä»¥ä¸‹æ˜¯ä»–ä¸<code>React Hooks</code>çš„åŒºåˆ«ï¼š</p> <ol><li><p><code>React Hooks</code>æ²¡æœ‰ä½¿ç”¨<code>isMount</code>å˜é‡ï¼Œè€Œæ˜¯åœ¨ä¸åŒæ—¶æœºä½¿ç”¨ä¸åŒçš„<code>dispatcher</code>ã€‚æ¢è¨€ä¹‹ï¼Œ<code>mount</code>æ—¶çš„<code>useState</code>ä¸<code>update</code>æ—¶çš„<code>useState</code>ä¸æ˜¯åŒä¸€ä¸ªå‡½æ•°ã€‚</p></li> <li><p><code>React Hooks</code>æœ‰ä¸­é€”è·³è¿‡<code>æ›´æ–°</code>çš„ä¼˜åŒ–æ‰‹æ®µã€‚</p></li> <li><p><code>React Hooks</code>æœ‰<code>batchedUpdates</code>ï¼Œå½“åœ¨<code>click</code>ä¸­è§¦å‘ä¸‰æ¬¡<code>updateNum</code>ï¼Œ<code>ç²¾ç®€React</code>ä¼šè§¦å‘ä¸‰æ¬¡æ›´æ–°ï¼Œè€Œ<code>React</code>åªä¼šè§¦å‘ä¸€æ¬¡ã€‚</p></li> <li><p><code>React Hooks</code>çš„<code>update</code>æœ‰<code>ä¼˜å…ˆçº§</code>æ¦‚å¿µï¼Œå¯ä»¥è·³è¿‡ä¸é«˜ä¼˜å…ˆçš„<code>update</code>ã€‚</p></li></ol> <p>æ›´å¤šçš„ç»†èŠ‚ï¼Œæˆ‘ä»¬ä¼šåœ¨æœ¬ç« åç»­å°èŠ‚è®²è§£ã€‚</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/BetaSu/just-react/edit/master/docs/hooks/create.md" target="_blank" rel="noopener noreferrer">ä¸ºè¯¥ç« èŠ‚çº é”™</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">7/23/2020, 3:19:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/just-react/hooks/prepare.html" class="prev">
        Hooksç†å¿µ
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/just-react/assets/js/app.3ca5235f.js" defer></script><script src="/just-react/assets/js/2.ceab786f.js" defer></script><script src="/just-react/assets/js/8.fb63fdcd.js" defer></script>
  </body>
</html>
